@model AdvancedTodoLearningCards.ViewModels.UserManagementViewModel

@{
    ViewData["Title"] = "User Management";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold">
            <i class="fas fa-users me-2"></i>
            User Management
        </h1>
        <a asp-action="Dashboard" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Dashboard
        </a>
    </div>

    <!-- Search -->
    <div class="card-custom p-3 mb-4">
        <form asp-action="Users" method="get" class="row g-3">
            <div class="col-md-10">
                <div class="input-group">
                    <span class="input-group-text">
                        <i class="fas fa-search"></i>
                    </span>
                    <input type="text" name="search" value="@Model.SearchTerm"
                           class="form-control" placeholder="Search by username or email...">
                </div>
            </div>
            <div class="col-md-2">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-1"></i>Search
                </button>
            </div>
        </form>
    </div>

    <!-- Users Table -->
    <div class="card-custom">
        <div class="card-header-gradient">
            <h4 class="mb-0">
                <i class="fas fa-list me-2"></i>
                All Users (@Model.Users.Count)
            </h4>
        </div>
        <div class="card-body p-0">
            @if (Model.Users.Any())
            {
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Joined</th>
                                <th>Last Login</th>
                                <th class="text-center">Cards</th>
                                <th class="text-center">Reviews</th>
                                <th class="text-center">Today</th>
                                <th class="text-center">Avg Quality</th>
                                <th class="text-center">Days Active</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var user in Model.Users)
                            {
                                <tr>
                                    <td>
                                        <strong>@user.UserName</strong>
                                    </td>
                                    <td>
                                        <small class="text-muted">@user.Email</small>
                                    </td>
                                    <td>
                                        <small>@user.CreatedAt.ToString("MMM dd, yyyy")</small>
                                    </td>
                                    <td>
                                        @if (user.LastLoginAt.HasValue)
                                        {
                                            <small>@user.LastLoginAt.Value.ToString("MMM dd, HH:mm")</small>
                                        }
                                        else
                                        {
                                            <small class="text-muted">Never</small>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-primary">@user.CardCount</span>
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-success">@user.ReviewCount</span>
                                    </td>
                                    <td class="text-center">
                                        @if (user.ReviewsToday > 0)
                                        {
                                            <span class="badge bg-warning">@user.ReviewsToday</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">0</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        @if (user.ReviewCount > 0)
                                        {
                                            <span class="badge bg-info">@user.AverageQuality.ToString("F1")</span>
                                        }
                                        else
                                        {
                                            <span class="badge bg-secondary">N/A</span>
                                        }
                                    </td>
                                    <td class="text-center">
                                        <span class="badge bg-dark">@user.DaysActive</span>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="fas fa-users-slash fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">No users found</h4>
                    @if (!string.IsNullOrEmpty(Model.SearchTerm))
                    {
                        <p class="text-secondary">Try a different search term</p>
                        <a asp-action="Users" class="btn btn-primary-custom">
                            <i class="fas fa-redo me-2"></i>Show All Users
                        </a>
                    }
                </div>
            }
        </div>
    </div>

    <!-- Summary Statistics -->
    @if (Model.Users.Any())
    {
        <div class="row g-4 mt-4">
            <div class="col-md-3">
                <div class="stats-card">
                    <small class="text-muted d-block mb-1">Total Users</small>
                    <h3 class="mb-0">@Model.Users.Count</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <small class="text-muted d-block mb-1">Total Cards</small>
                    <h3 class="mb-0">@Model.Users.Sum(u => u.CardCount)</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <small class="text-muted d-block mb-1">Total Reviews</small>
                    <h3 class="mb-0">@Model.Users.Sum(u => u.ReviewCount)</h3>
                </div>
            </div>
            <div class="col-md-3">
                <div class="stats-card">
                    <small class="text-muted d-block mb-1">Active Today</small>
                    <h3 class="mb-0">@Model.Users.Count(u => u.ReviewsToday > 0)</h3>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .table th {
        background-color: var(--bg-secondary);
        font-weight: 600;
        color: var(--text-primary);
        border-bottom: 2px solid var(--border-color);
    }

    .table tbody tr {
        transition: background-color 0.2s ease;
    }

    .table tbody tr:hover {
        background-color: var(--bg-secondary);
    }
</style>
